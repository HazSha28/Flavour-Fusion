<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search Results - Flavour Fusion</title>
  <link rel="icon" href="./images/Flavour Fusion.png">
  <link rel="stylesheet" href="./style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Limelight&family=Unlock&display=swap" rel="stylesheet">
  <style>
    .search-header {
      text-align: center;
      padding: 20px;
      background-color: #8b977c;
      color: #333333;
      margin-bottom: 30px;
    }
    
    .search-query {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .results-count {
      font-size: 16px;
      color: #555;
    }
    
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #333333;
    }
    
    .error {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #d32f2f;
    }
    
    .recipe-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      margin: 30px auto;
      width: 85%;
    }
    
    .recipe-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    
    .recipe-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .recipe-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    .recipe-info {
      padding: 20px;
    }
    
    .recipe-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333333;
      font-family: Georgia, 'Times New Roman', Times, serif;
    }
    
    .recipe-category {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .recipe-area {
      font-size: 14px;
      color: #888;
      font-style: italic;
    }
    
    .no-results {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #666;
    }
    
    .search-again {
      margin-top: 20px;
    }
    
    .search-again input {
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      background-color: rgba(255, 255, 255, 0.7);
      color: #333333;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 14px;
      width: 300px;
      margin-right: 10px;
    }
    
    .search-again button {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      background-color: #8b977c;
      color: #333333;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .search-again button:hover {
      background-color: #7a8670;
    }
  </style>
</head>

<body>
  <header>
    <div class="logo">
      <img id="ilogo" src="./images/Flavour_Fusion-removebg-preview.png" alt="Logo">
      <span>FLAVOUR FUSION</span>
    </div>
    <nav class="navbar">
      <a href="./index.html">Home</a>
      <a href="./aboutus.html">About Us</a>
      <a href="./login.html">Login</a>
      <a href="./signup.html">Sign up</a>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search recipes..." class="search-input">
        <button id="searchBtn" class="search-btn">üîç</button>
      </div>
    </nav>
  </header>

  <div class="search-header">
    <div class="search-query" id="searchQuery">Loading...</div>
    <div class="results-count" id="resultsCount">Loading...</div>
  </div>

  <div id="loadingMessage" class="loading">Searching for delicious recipes...</div>
  <div id="errorMessage" class="error" style="display: none;"></div>
  <div id="noResults" class="no-results" style="display: none;">
    <p>No recipes found for your search. Try different keywords!</p>
    <div class="search-again">
      <input type="text" id="newSearchInput" placeholder="Search again...">
      <button onclick="performNewSearch()">Search</button>
    </div>
  </div>
  
  <div id="recipeResults" class="recipe-grid" style="display: none;"></div>

  <footer>
    &copy; All rights Reserved 2025
  </footer>

  <script>
    let currentSearchTerm = '';
    
    // Get search term from URL
    function getSearchTermFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('q') || '';
    }
    
    // Search TheMealDB API
    async function searchMeals(query) {
      try {
        const response = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${encodeURIComponent(query)}`);
        const data = await response.json();
        return data.meals || [];
      } catch (error) {
        console.error('Error searching meals:', error);
        return [];
      }
    }
    
    // Display search results
    function displayResults(meals, searchTerm) {
      const loadingMessage = document.getElementById('loadingMessage');
      const errorMessage = document.getElementById('errorMessage');
      const noResults = document.getElementById('noResults');
      const recipeResults = document.getElementById('recipeResults');
      const searchQuery = document.getElementById('searchQuery');
      const resultsCount = document.getElementById('resultsCount');
      
      // Hide loading message
      loadingMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      noResults.style.display = 'none';
      
      // Update search query display
      searchQuery.textContent = `Search Results for "${searchTerm}"`;
      
      if (meals.length === 0) {
        resultsCount.textContent = 'No recipes found';
        noResults.style.display = 'block';
        recipeResults.style.display = 'none';
      } else {
        resultsCount.textContent = `Found ${meals.length} recipe${meals.length === 1 ? '' : 's'}`;
        recipeResults.style.display = 'grid';
        
        // Clear previous results
        recipeResults.innerHTML = '';
        
        // Display each meal
        meals.forEach(meal => {
          const recipeCard = createRecipeCard(meal);
          recipeResults.appendChild(recipeCard);
        });
      }
    }
    
    // Create recipe card element
    function createRecipeCard(meal) {
      const card = document.createElement('a');
      card.href = `recipe-detail.html?id=${meal.idMeal}`;
      card.className = 'recipe-card';
      
      card.innerHTML = `
        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="recipe-image">
        <div class="recipe-info">
          <div class="recipe-title">${meal.strMeal}</div>
          <div class="recipe-category">${meal.strCategory || 'Unknown Category'}</div>
          <div class="recipe-area">${meal.strArea || 'Unknown Cuisine'}</div>
        </div>
      `;
      
      return card;
    }
    
    // Perform new search
    function performNewSearch() {
      const newSearchInput = document.getElementById('newSearchInput');
      const searchTerm = newSearchInput.value.trim();
      
      if (searchTerm) {
        window.location.href = `search-results.html?q=${encodeURIComponent(searchTerm)}`;
      }
    }
    
    // Initialize search functionality
    document.addEventListener('DOMContentLoaded', async function() {
      // Get search term from URL
      currentSearchTerm = getSearchTermFromURL();
      
      if (!currentSearchTerm) {
        document.getElementById('loadingMessage').textContent = 'No search term provided';
        return;
      }
      
      // Update search input
      document.getElementById('searchInput').value = currentSearchTerm;
      document.getElementById('newSearchInput').value = currentSearchTerm;
      
      try {
        // Search for meals
        const meals = await searchMeals(currentSearchTerm);
        
        // Display results
        displayResults(meals, currentSearchTerm);
        
      } catch (error) {
        console.error('Search error:', error);
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('errorMessage').textContent = 'An error occurred while searching. Please try again.';
      }
    });
    
    // Add search functionality to header search bar
    document.getElementById('searchBtn').addEventListener('click', function() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      if (searchTerm) {
        window.location.href = `search-results.html?q=${encodeURIComponent(searchTerm)}`;
      }
    });
    
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const searchTerm = this.value.trim();
        if (searchTerm) {
          window.location.href = `search-results.html?q=${encodeURIComponent(searchTerm)}`;
        }
      }
    });
  </script>
</body>
</html>
